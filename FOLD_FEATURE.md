# JSON/XML 对象和数组折叠功能说明

## 功能概述

为 JSON 和 XML 格式化工具添加了对象和数组的展开/折叠功能，让用户可以更方便地浏览和管理大型的 JSON/XML 文件。

## 功能特点

1. **智能识别**：自动识别 JSON 对象 `{}` 和数组 `[]`
2. **可视化控制**：每个可折叠的对象/数组前都有折叠按钮
   - `−` 表示已展开，点击可折叠
   - `+` 表示已折叠，点击可展开
3. **批量操作**：
   - `[ + ]` 按钮：展开所有折叠
   - `[ − ]` 按钮：折叠所有对象/数组
4. **数据保护**：折叠不会修改原始数据，仅改变显示方式
5. **多层折叠**：支持同时折叠多个区域，包括嵌套的对象和数组

## 使用方法

### 基本步骤

1. 在文本框中输入或粘贴 JSON/XML 内容
2. 点击 `Lint Me!` 按钮进行格式化
3. 格式化成功后，右侧会出现折叠控制按钮：
   - 每行前面的 `−` 按钮：折叠单个对象/数组
   - 右上角的 `[ + ]` 按钮：展开全部
   - 右上角的 `[ − ]` 按钮：折叠全部

### 使用示例

#### JSON 示例
```json
{
  "users": [
    {
      "name": "张三",
      "age": 25,
      "address": {
        "city": "北京",
        "street": "长安街"
      }
    },
    {
      "name": "李四",
      "age": 30,
      "address": {
        "city": "上海",
        "street": "南京路"
      }
    }
  ],
  "total": 2
}
```

格式化后：
- 点击 `users` 数组前的 `−`，数组会折叠为 `"users": [ ... ]`
- 点击 `address` 对象前的 `−`，对象会折叠为 `"address": { ... }`
- 点击 `[ − ]` 按钮，所有对象和数组都会折叠

## 技术实现

### 核心文件

1. **fold-helper.js**：折叠功能的核心逻辑
   - `addFoldButtons()`：添加折叠按钮
   - `toggleFold()`：切换单个折叠状态
   - `expandAll()`：展开全部
   - `foldAll()`：折叠全部
   - `foldToLevel(level)`：折叠到指定层级

2. **main.js**：集成到主应用
   - 添加了 `expand-all` 和 `fold-all` 按钮
   - 添加了 `onExpandAll` 和 `onFoldAll` 事件处理
   - 在格式化成功后自动添加折叠按钮

3. **screen.css**：按钮样式
   - 折叠按钮的位置和样式定义

### 工作原理

1. **识别可折叠区域**：遍历格式化后的内容，识别成对的 `{}`、`[]`
2. **添加控制按钮**：在每个可折叠区域的开始行添加折叠按钮
3. **切换显示**：
   - 折叠时：保留开始行并添加 `{ ... }` 或 `[ ... ]` 标记，隐藏中间行
   - 展开时：恢复显示所有行
4. **保留原始数据**：始终保存原始内容，只修改显示的内容

## 浏览器兼容性

- Chrome / Edge（推荐）
- Firefox
- Safari
- 需要支持 ES5+ JavaScript

## 注意事项

1. 折叠功能只在格式化成功后可用
2. 重新格式化或重置会清除折叠状态
3. 折叠不会影响原始数据的复制和导出

## 快捷操作

- **Ctrl + Enter**：快速格式化
- 格式化后可以直接点击行号前的按钮进行折叠
- 使用右上角的批量按钮快速管理所有折叠

## 未来改进方向

- [ ] 添加快捷键支持（如：Ctrl + [展开], Ctrl + ]折叠）
- [ ] 记住用户的折叠偏好
- [ ] 支持按层级折叠（折叠所有第 N 层的对象/数组）
- [ ] 支持正则表达式搜索并折叠匹配的区域
